I"Ê<h3 id="gcdçš„ä½¿ç”¨">GCDçš„ä½¿ç”¨</h3>

<h4 id="blockçš„å®šä¹‰">blockçš„å®šä¹‰</h4>
<p>block æœ‰ç‚¹åƒå‡½æ•°æŒ‡é’ˆï¼Œåªä¸è¿‡ç”¨<strong>â€^â€</strong>ä»£æ›¿äº†<strong>â€œ*â€œ</strong></p>

<ul>
  <li>ç”³æ˜å˜é‡ï¼š<code class="language-plaintext highlighter-rouge">(void)(^loggerBlock)(void);</code></li>
  <li>å®šä¹‰ï¼š<code class="language-plaintext highlighter-rouge">loggerBlock = ^{ NSLog(@"Hello World");};</code></li>
  <li>è°ƒç”¨ï¼š<code class="language-plaintext highlighter-rouge">loggerBlock();</code></li>
</ul>

<p>blockç‰¹ç‚¹ï¼š</p>

<ol>
  <li>ç¨‹åºå—å¯ä»¥åœ¨ä»£ç ä¸­ä»¥å†…è”çš„æ–¹å¼æ¥å®šä¹‰ã€‚</li>
  <li>ç¨‹åºå—å¯ä»¥è®¿é—®åœ¨åˆ›å»ºå®ƒçš„èŒƒå›´å†…çš„å¯ç”¨å˜é‡ã€‚</li>
</ol>

<h4 id="ç³»ç»Ÿçš„dispatchæ–¹æ³•">ç³»ç»Ÿçš„dispatchæ–¹æ³•</h4>
<p>è‹¹æœæä¾›äº†ä¸€äº›æ–¹æ³•æ–¹ä¾¿æˆ‘ä»¬å°†blockæ”¾åœ¨ä¸»çº¿ç¨‹æˆ–åå°çº¿ç¨‹æ‰§è¡Œæˆ–å’½å–‰æ‰§è¡Œã€‚</p>

<ul>
  <li>åå°æ‰§è¡Œï¼š</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     dispatch_async(dispatch_get_global_queue(0, 0), ^{
        // something
    });
</code></pre></div></div>
<ul>
  <li>ä¸»çº¿ç¨‹æ‰§è¡Œï¼š</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dispatch_async(dispatch_get_main_queue(), ^{
        // something
    });
</code></pre></div></div>
<ul>
  <li>ä¸€æ¬¡æ‰§è¡Œï¼š</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   static dispatch_once_t onceToken;
    dispatch_once(&amp;onceToken, ^{
        // code to be executed once
    });
</code></pre></div></div>
<ul>
  <li>å»¶è¿Ÿæ‰§è¡Œï¼š</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>double delayInSeconds = 2.0;
    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(delayInSeconds * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{
        // code to be executed after a specified delay
    });
</code></pre></div></div>

<ul>
  <li>è‡ªå®šä¹‰dispatch_queue_t,ä½¿ç”¨dispatch_queue_createæ–¹æ³•:</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> dispatch_queue_t queue = dispatch_queue_create("hello", NULL);
    dispatch_async(queue, ^{
        // something
    });
</code></pre></div></div>
<ul>
  <li>å¤šçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œï¼Œç­‰çº¿ç¨‹æ‰§è¡Œç»“æŸåœ¨æ±‡æ€»æ‰§è¡Œç»“æœã€‚ä½¿ç”¨<code class="language-plaintext highlighter-rouge">dispatch_group</code>,<code class="language-plaintext highlighter-rouge">dispatch_group_async</code>å’Œ<code class="language-plaintext highlighter-rouge">dispatch_group_notify</code>æ¥å®ç°ï¼š</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    dispatch_group_t group = dispatch_group_create();
    dispatch_group_async(group, dispatch_get_global_queue(0, 0), ^{
        // å¹¶è¡Œçº¿ç¨‹ä¸€
    });
    dispatch_group_async(group, dispatch_get_global_queue(0, 0), ^{
        // å¹¶è¡Œçº¿ç¨‹äºŒ
    });
    dispatch_group_notify(group, dispatch_get_global_queue(0, 0), ^{
        // æ±‡æ€»ç»“æœ
    });

</code></pre></div></div>

<h4 id="ä¿®æ”¹blockä¹‹å¤–çš„å˜é‡">ä¿®æ”¹blockä¹‹å¤–çš„å˜é‡</h4>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨blockä¸­è®¿é—®çš„å¤–éƒ¨å˜é‡æ˜¯å¤åˆ¶è¿‡å»çš„ï¼Œå³å†™æ“ä½œä¸å¯¹åŸå˜é‡ç”Ÿæ•ˆã€‚ä½†æ˜¯å¯ä»¥åŠ ä¸Š<strong>__block</strong>æ¥è®©å†™æ“ä½œç”Ÿæ•ˆï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>__block int a = 0;
void (^foo)(void) = ^{
	a = 1;
}
foo(); // a ä¸º 1
</code></pre></div></div>

<h4 id="åå°è¿è¡Œ">åå°è¿è¡Œ</h4>
<p>åœ¨é€€å‡ºç¨‹åºå›åˆ°homeé¡µæ—¶å¯ä»¥è°ƒç”¨UIApplicationçš„<code class="language-plaintext highlighter-rouge">beginBackgroundTaskWithExpirationHandler</code>æ–¹æ³•,è®©ç¨‹åºæœ€å¤šæœ‰ååˆ†é’Ÿçš„æ—¶é—´åœ¨åå°é•¿ä¹…è¿è¡Œã€‚è¿™ä¸ªæ—¶é—´æˆ‘ä»¬å¯ä»¥ç”¨æ¥æ¸…ç†æœ¬åœ°ç¼“å­˜ï¼Œå‘é€ç»Ÿè®¡æ•°æ®ç­‰ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// AppDelegate.hä¸­
@property (nonatomic,assign) UIBackgroundTaskIdentifier backgroundUpdateTask;  

// AppDelegate.mä¸­
- (void)applicationDidEnterBackground:(UIApplication *)application
{
    [self beginBackgroundUpdateTask];
    
    // é•¿ä¹…è¿è¡Œä»£ç 
    
    [self endBackgroundUpdateTask];
}

- (void)beginBackgroundUpdateTask {

self.backgroundUpdateTask = [[UIApplication sharedApplication] beginBackgroundTaskWithExpirationHandler:^{
    [self endBackgroundUpdateTask];
}];
}

- (void)endBackgroundUpdateTask {
    [[UIApplication sharedApplication] endBackgroundTask:self.backgroundUpdateTask];
    self.backgroundUpdateTask = UIBackgroundTaskInvalid;
}

</code></pre></div></div>
:ET